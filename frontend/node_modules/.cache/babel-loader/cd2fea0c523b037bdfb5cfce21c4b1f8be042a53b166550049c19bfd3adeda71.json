{"ast":null,"code":"import { csrfFetch } from \"./csrf\";\nconst LOAD = 'reviews/LOAD';\nconst CREATE = 'reviews/CREATE';\nconst DELETE = 'reviews/DELETE';\nconst load = reviews => ({\n  type: LOAD,\n  reviews\n});\nconst create = review => ({\n  type: CREATE,\n  review\n});\nconst remove = reviewId => ({\n  type: DELETE,\n  reviewId\n});\nexport const getReviews = id => async dispatch => {\n  const response = await csrfFetch(`/api/spots/${id}/reviews`);\n  if (response.ok) {\n    const {\n      Reviews\n    } = await response.json();\n    dispatch(load(Reviews));\n    return Reviews;\n  }\n  return response;\n};\nexport const postReview = payload => async dispatch => {\n  console.log('hello from postReview');\n  const {\n    reviewPayload,\n    spotIdPayload\n  } = payload;\n  console.log('reviewPayload', reviewPayload);\n  console.log('spotId', spotIdPayload);\n  const response = await csrfFetch(`/api/spots/${spotIdPayload}/reviews`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(reviewPayload)\n  });\n  console.log('response: ', response);\n  if (response.ok) {\n    console.log('hello from response.ok');\n    const review = response.json();\n    console.log('review: ', review);\n    dispatch(create(review));\n    return review;\n  }\n  return response;\n};\nexport const deleteReview = id => async dispatch => {\n  const response = await csrfFetch(`/api/reviews/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  if (response.ok) {\n    const {\n      message\n    } = await response.json();\n    dispatch(remove(id));\n    return message;\n  }\n  return response;\n};\nconst intialState = {\n  spots: {},\n  user: {}\n};\nconst reviewReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : intialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case LOAD:\n      {\n        const newState = {\n          ...state,\n          spots: {}\n        };\n        let reviewsNormalize = {};\n        action.reviews.forEach(review => {\n          reviewsNormalize[review.id] = review;\n        });\n        newState.spots = reviewsNormalize;\n        return newState;\n      }\n    case CREATE:\n      {\n        const newState = {\n          ...state\n        };\n        let review2 = {\n          ...state.spots\n        };\n        review2[action.review.id] = action.review;\n        newState.spots = review2;\n        return newState;\n      }\n    case DELETE:\n      {}\n    default:\n      return state;\n  }\n};\nexport default reviewReducer;","map":{"version":3,"names":["csrfFetch","LOAD","CREATE","DELETE","load","reviews","type","create","review","remove","reviewId","getReviews","id","dispatch","response","ok","Reviews","json","postReview","payload","console","log","reviewPayload","spotIdPayload","method","headers","body","JSON","stringify","deleteReview","message","intialState","spots","user","reviewReducer","state","action","newState","reviewsNormalize","forEach","review2"],"sources":["/home/marc/exercise/projects/airbnb/frontend/src/store/reviewReducer.js"],"sourcesContent":["import { csrfFetch } from \"./csrf\"\n\nconst LOAD = 'reviews/LOAD'\nconst CREATE = 'reviews/CREATE'\nconst DELETE = 'reviews/DELETE'\n\n\nconst load = reviews => ({\n    type: LOAD,\n    reviews\n})\n\nconst create = review => ({\n    type: CREATE,\n    review\n})\n\nconst remove = reviewId => ({\n    type: DELETE,\n    reviewId\n})\n\n\nexport const getReviews = (id) => async dispatch => {\n    const response = await csrfFetch(`/api/spots/${id}/reviews`);\n\n    if (response.ok){\n        const {Reviews} = await response.json();\n        dispatch(load(Reviews))\n        return Reviews\n    }\n    return response\n}\n\nexport const postReview = (payload) => async dispatch =>{\n    console.log('hello from postReview')\n    const {reviewPayload, spotIdPayload} = payload\n    console.log('reviewPayload', reviewPayload)\n    console.log('spotId', spotIdPayload)\n    const response = await csrfFetch(`/api/spots/${spotIdPayload}/reviews`,{\n        method: 'POST',\n        headers: {'Content-Type': 'application/json'},\n        body: JSON.stringify(reviewPayload)\n    })\n    console.log('response: ', response)\n    if(response.ok){\n        console.log('hello from response.ok')\n        const review = response.json();\n        console.log('review: ', review)\n        dispatch(create(review))\n        return review\n    }\n    return response\n}\n\nexport const deleteReview = (id) => async dispatch => {\n    const response = await csrfFetch(`/api/reviews/${id}`, {\n        method: 'DELETE',\n        headers: {'Content-Type': 'application/json'}\n    })\n    if(response.ok){\n        const {message}= await response.json()\n        dispatch(remove(id))\n        return message\n    }\n    return response\n}\n\nconst intialState = {spots:{}, user: {}}\n\nconst reviewReducer = (state = intialState, action) => {\n    switch (action.type) {\n        case LOAD:{\n\n            const newState = {...state, spots: {}}\n            let reviewsNormalize = {};\n            action.reviews.forEach(review => {\n                reviewsNormalize[review.id] = review\n            });\n            newState.spots = reviewsNormalize\n            return newState\n        }\n        case CREATE: {\n            const newState = {...state}\n            let review2 = {...state.spots}\n            review2[action.review.id] = action.review\n            newState.spots = review2\n            return newState\n        }\n        case DELETE: {\n            \n        }\n        default:\n            return state\n    }\n}\n\nexport default reviewReducer\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}