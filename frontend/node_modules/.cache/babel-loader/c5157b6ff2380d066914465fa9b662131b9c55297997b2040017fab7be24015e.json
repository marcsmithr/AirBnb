{"ast":null,"code":"import _regeneratorRuntime from\"/home/marc/exercise/projects/airbnb/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/marc/exercise/projects/airbnb/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{csrfFetch}from'./csrf';var SET_USER='session/setUser';var REMOVE_USER='session/removeUser';var setUser=function setUser(user){return{type:SET_USER,payload:user};};var removeUser=function removeUser(){return{type:REMOVE_USER};};export var login=function login(user){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var credential,password,response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:credential=user.credential,password=user.password;_context.next=3;return csrfFetch('/api/session',{method:'POST',body:JSON.stringify({credential:credential,password:password})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;dispatch(setUser(data.user));return _context.abrupt(\"return\",response);case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var initialState={user:null};var sessionReducer=function sessionReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;var newState;switch(action.type){case SET_USER:newState=Object.assign({},state);newState.user=action.payload;return newState;case REMOVE_USER:newState=Object.assign({},state);newState.user=null;return newState;default:return state;}};export var restoreUser=function restoreUser(){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return csrfFetch('/api/session');case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;dispatch(setUser(data.user));return _context2.abrupt(\"return\",response);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var signup=function signup(user){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var username,firstName,lastName,email,password,response,data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:username=user.username,firstName=user.firstName,lastName=user.lastName,email=user.email,password=user.password;_context3.next=3;return csrfFetch(\"/api/users\",{method:\"POST\",body:JSON.stringify({username:username,firstName:firstName,lastName:lastName,email:email,password:password})});case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:data=_context3.sent;dispatch(setUser(data.user));return _context3.abrupt(\"return\",response);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){var response;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return csrfFetch('/api/session',{method:'DELETE'});case 2:response=_context4.sent;dispatch(removeUser());return _context4.abrupt(\"return\",response);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export default sessionReducer;","map":{"version":3,"names":["csrfFetch","SET_USER","REMOVE_USER","setUser","user","type","payload","removeUser","login","dispatch","credential","password","method","body","JSON","stringify","response","json","data","initialState","sessionReducer","state","action","newState","Object","assign","restoreUser","signup","username","firstName","lastName","email","logout"],"sources":["/home/marc/exercise/projects/airbnb/frontend/src/store/session.js"],"sourcesContent":["import { csrfFetch } from './csrf';\n\nconst SET_USER = 'session/setUser';\nconst REMOVE_USER = 'session/removeUser';\n\nconst setUser = (user) => {\n  return {\n    type: SET_USER,\n    payload: user,\n  };\n};\n\nconst removeUser = () => {\n  return {\n    type: REMOVE_USER,\n  };\n};\n\nexport const login = (user) => async (dispatch) => {\n  const { credential, password } = user;\n  const response = await csrfFetch('/api/session', {\n    method: 'POST',\n    body: JSON.stringify({\n      credential,\n      password,\n    }),\n  });\n  const data = await response.json();\n  dispatch(setUser(data.user));\n  return response;\n};\n\nconst initialState = { user: null };\n\nconst sessionReducer = (state = initialState, action) => {\n  let newState;\n  switch (action.type) {\n    case SET_USER:\n      newState = Object.assign({}, state);\n      newState.user = action.payload;\n      return newState;\n    case REMOVE_USER:\n      newState = Object.assign({}, state);\n      newState.user = null;\n      return newState;\n    default:\n      return state;\n  }\n};\n\nexport const restoreUser = () => async dispatch => {\n    const response = await csrfFetch('/api/session');\n    const data = await response.json();\n    dispatch(setUser(data.user));\n    return response;\n  };\n\nexport const signup = (user) => async (dispatch) => {\n    const { username, firstName, lastName, email, password } = user;\n    const response = await csrfFetch(\"/api/users\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        username,\n        firstName,\n        lastName,\n        email,\n        password,\n      }),\n    });\n    const data = await response.json();\n    dispatch(setUser(data.user));\n    return response;\n};\n\nexport const logout = () => async (dispatch) => {\n    const response = await csrfFetch('/api/session', {\n      method: 'DELETE',\n    });\n    dispatch(removeUser());\n    return response;\n  };\n\nexport default sessionReducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}